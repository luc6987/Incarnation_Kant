# Digital Kant Baseline v2.0 - é¡¹ç›®ç»“æ„å®šä¹‰
# Project Structure Definition (YAML)

project_name: "Digital Kant Baseline v2.0"
version: "2.0.0"
description: "è·¨è¯­è¨€ã€è·¨æ—¶ç©ºçš„åº·å¾·æ•°å­—äººæ ¼ - åŸºäº Korpora çš„ 18 ä¸–çºªå¾·è¯­åŸæ–‡ RAG"

# æ ¹ç›®å½•ç»“æ„
root_structure:
  - name: "app"
    description: "Streamlit å‰ç«¯åº”ç”¨"
    type: "directory"
    children:
      - name: "__init__.py"
        type: "file"
        description: "Python åŒ…åˆå§‹åŒ–æ–‡ä»¶"
      - name: "main.py"
        type: "file"
        description: "Streamlit ä¸»å…¥å£æ–‡ä»¶"
      - name: "ui"
        type: "directory"
        description: "UI ç»„ä»¶æ¨¡å—"
        children:
          - name: "__init__.py"
          - name: "components.py"
            description: "å¯å¤ç”¨çš„ Streamlit ç»„ä»¶"
          - name: "layouts.py"
            description: "é¡µé¢å¸ƒå±€å®šä¹‰"
      - name: "config.py"
        type: "file"
        description: "åº”ç”¨é…ç½®ç®¡ç†"

  - name: "src"
    description: "æ ¸å¿ƒæºä»£ç "
    type: "directory"
    children:
      - name: "__init__.py"
        type: "file"
      
      # æ¨¡å—ä¸€ï¼šæ•°æ®åº“æ„é€ 
      - name: "database"
        type: "directory"
        description: "æ•°æ®åº“æ„é€ æ¨¡å— - æŠ“å–ã€æ¸…æ´—ã€åˆ‡ç‰‡ã€å­˜å‚¨"
        children:
          - name: "__init__.py"
          - name: "scraper.py"
            description: "Korpora ç½‘é¡µæŠ“å–å™¨"
          - name: "cleaner.py"
            description: "HTML æ¸…æ´—ï¼Œä¿ç•™å¼•ç”¨å…ƒæ•°æ®"
          - name: "chunker.py"
            description: "æŒ‰æ®µè½åˆ‡åˆ†æ–‡æœ¬"
          - name: "indexer.py"
            description: "ChromaDB ç´¢å¼•æ„å»º"
          - name: "builder.py"
            description: "æ•°æ®åº“æ„å»ºä¸»æµç¨‹"
      
      # æ¨¡å—äºŒï¼šHyDE æ¡¥æ¥
      - name: "hyde"
        type: "directory"
        description: "å…¨è¯­è¨€è¾“å…¥ä¸ HyDE æ¡¥æ¥æ¨¡å—"
        children:
          - name: "__init__.py"
          - name: "translator.py"
            description: "å°†ä»»æ„è¯­è¨€é—®é¢˜è½¬åŒ–ä¸º 18 ä¸–çºªå¾·è¯­é£æ ¼"
          - name: "embedder.py"
            description: "å‘é‡åµŒå…¥ç”Ÿæˆ"
          - name: "retriever.py"
            description: "ChromaDB æ£€ç´¢å™¨"
          - name: "bridge.py"
            description: "HyDE æ¡¥æ¥ä¸»æµç¨‹"
      
      # æ¨¡å—ä¸‰ï¼šç°ä»£é‡è¿°
      - name: "rearticulation"
        type: "directory"
        description: "ç°ä»£é‡è¿°å¼•æ“ - ç¬¬ä¸€äººç§°è¾“å‡º"
        children:
          - name: "__init__.py"
          - name: "prompt_builder.py"
            description: "System Prompt æ„å»ºå™¨"
          - name: "generator.py"
            description: "LLM ç”Ÿæˆå™¨ï¼ˆGeminiï¼‰"
          - name: "formatter.py"
            description: "è¾“å‡ºæ ¼å¼åŒ–ï¼ˆåŸæ–‡å¼•ç”¨ + ç°ä»£é‡è¿°ï¼‰"
          - name: "engine.py"
            description: "é‡è¿°å¼•æ“ä¸»æµç¨‹"
      
      # å·¥å…·æ¨¡å—
      - name: "utils"
        type: "directory"
        description: "é€šç”¨å·¥å…·å‡½æ•°"
        children:
          - name: "__init__.py"
          - name: "logger.py"
            description: "æ—¥å¿—é…ç½®"
          - name: "config_loader.py"
            description: "é…ç½®åŠ è½½å™¨"
          - name: "language_detector.py"
            description: "è¯­è¨€æ£€æµ‹"
          - name: "text_processor.py"
            description: "æ–‡æœ¬å¤„ç†å·¥å…·å‡½æ•°"

  - name: "data"
    description: "æ•°æ®å­˜å‚¨ç›®å½•"
    type: "directory"
    children:
      - name: "raw"
        type: "directory"
        description: "åŸå§‹æŠ“å–çš„ HTML/æ–‡æœ¬æ–‡ä»¶"
      - name: "cleaned"
        type: "directory"
        description: "æ¸…æ´—åçš„çº¯æ–‡æœ¬æ–‡ä»¶"
      - name: "chunks"
        type: "directory"
        description: "åˆ‡åˆ†åçš„æ–‡æœ¬å—ï¼ˆJSON/Parquetï¼‰"
      - name: "chromadb"
        type: "directory"
        description: "ChromaDB æ•°æ®åº“æ–‡ä»¶"
        gitignore: true

  - name: "tests"
    description: "æµ‹è¯•æ–‡ä»¶"
    type: "directory"
    children:
      - name: "__init__.py"
      - name: "test_database.py"
        description: "æ•°æ®åº“æ¨¡å—æµ‹è¯•"
      - name: "test_hyde.py"
        description: "HyDE æ¨¡å—æµ‹è¯•"
      - name: "test_rearticulation.py"
        description: "é‡è¿°æ¨¡å—æµ‹è¯•"
      - name: "test_integration.py"
        description: "é›†æˆæµ‹è¯•"
      - name: "fixtures"
        type: "directory"
        description: "æµ‹è¯•æ•°æ®"

  - name: "logs"
    description: "æ—¥å¿—æ–‡ä»¶ç›®å½•"
    type: "directory"
    gitignore: true

  - name: "config"
    description: "é…ç½®æ–‡ä»¶ç›®å½•"
    type: "directory"
    children:
      - name: "default.yaml"
        description: "é»˜è®¤é…ç½®"
      - name: "prompts.yaml"
        description: "Prompt æ¨¡æ¿é…ç½®"
      - name: "model_config.yaml"
        description: "æ¨¡å‹é…ç½®ï¼ˆGemini API Key ç­‰ï¼‰"

  - name: "scripts"
    description: "è„šæœ¬å·¥å…·"
    type: "directory"
    children:
      - name: "build_database.py"
        description: "æ„å»ºæ•°æ®åº“çš„ç‹¬ç«‹è„šæœ¬"
      - name: "test_retrieval.py"
        description: "æµ‹è¯•æ£€ç´¢æ•ˆæœ"
      - name: "benchmark.py"
        description: "æ€§èƒ½åŸºå‡†æµ‹è¯•"

  - name: "docs"
    description: "æ–‡æ¡£ç›®å½•"
    type: "directory"
    children:
      - name: "api.md"
        description: "API æ–‡æ¡£"
      - name: "architecture.md"
        description: "æ¶æ„è®¾è®¡æ–‡æ¡£"
      - name: "deployment.md"
        description: "éƒ¨ç½²æŒ‡å—"

# æ ¹ç›®å½•æ–‡ä»¶
root_files:
  - name: "README.md"
    description: "é¡¹ç›®è¯´æ˜æ–‡æ¡£"
  - name: "requirements.txt"
    description: "Python ä¾èµ–åŒ…"
  - name: "requirements-dev.txt"
    description: "å¼€å‘ç¯å¢ƒä¾èµ–"
  - name: ".gitignore"
    description: "Git å¿½ç•¥æ–‡ä»¶"
  - name: ".cursorrules"
    description: "Cursor AI è§„åˆ™æ–‡ä»¶"
  - name: "pyproject.toml"
    description: "é¡¹ç›®å…ƒæ•°æ®å’Œæ„å»ºé…ç½®"
  - name: "LICENSE"
    description: "MIT è®¸å¯è¯"

# ç¯å¢ƒå˜é‡æ–‡ä»¶
env_files:
  - name: ".env.example"
    description: "ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶"
  - name: ".env"
    description: "å®é™…ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤åˆ° Gitï¼‰"
    gitignore: true

# æ¨¡å—ä¾èµ–å…³ç³»
module_dependencies:
  app:
    depends_on: ["src.rearticulation", "src.hyde", "src.utils"]
  
  src.database:
    depends_on: ["src.utils"]
    external: ["chromadb", "beautifulsoup4", "requests"]
  
  src.hyde:
    depends_on: ["src.database", "src.utils"]
    external: ["google-generativeai", "sentence-transformers"]
  
  src.rearticulation:
    depends_on: ["src.hyde", "src.utils"]
    external: ["google-generativeai"]
  
  src.utils:
    external: ["python-dotenv", "pyyaml", "langdetect"]

# æ•°æ®æµ
data_flow:
  - step: 1
    name: "æ•°æ®æŠ“å–"
    module: "src.database.scraper"
    input: "korpora.org URLs"
    output: "data/raw/*.html"
  
  - step: 2
    name: "æ•°æ®æ¸…æ´—"
    module: "src.database.cleaner"
    input: "data/raw/*.html"
    output: "data/cleaned/*.txt"
  
  - step: 3
    name: "æ–‡æœ¬åˆ‡åˆ†"
    module: "src.database.chunker"
    input: "data/cleaned/*.txt"
    output: "data/chunks/*.json"
  
  - step: 4
    name: "å‘é‡ç´¢å¼•"
    module: "src.database.indexer"
    input: "data/chunks/*.json"
    output: "data/chromadb/"
  
  - step: 5
    name: "ç”¨æˆ·æŸ¥è¯¢"
    module: "app.main"
    input: "ä»»æ„è¯­è¨€é—®é¢˜"
    output: "src.hyde.bridge"
  
  - step: 6
    name: "HyDE è½¬æ¢"
    module: "src.hyde.bridge"
    input: "ç”¨æˆ·é—®é¢˜"
    output: "å¾·è¯­ä¼ªæŸ¥è¯¢ + å‘é‡æ£€ç´¢ç»“æœ"
  
  - step: 7
    name: "ç°ä»£é‡è¿°"
    module: "src.rearticulation.engine"
    input: "æ£€ç´¢ç»“æœ + ç”¨æˆ·é—®é¢˜"
    output: "ç¬¬ä¸€äººç§°ç°ä»£è¯­è¨€é‡è¿°"

# é…ç½®ç®¡ç†
config_structure:
  app_config:
    streamlit:
      page_title: "Digital Kant v2.0"
      page_icon: "ğŸ›ï¸"
      layout: "wide"
  
  model_config:
    gemini:
      model_name: "gemini-pro"
      temperature: 0.7
      max_tokens: 2000
    
    embedding:
      model_name: "sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2"
      device: "cpu"
  
  database_config:
    chromadb:
      collection_name: "kant_korpora"
      persist_directory: "data/chromadb"
      embedding_function: "sentence-transformers"
  
  hyde_config:
    translation_prompt_template: "config/prompts.yaml::hyde_translation"
    max_query_length: 500
  
  rearticulation_config:
    system_prompt_template: "config/prompts.yaml::kant_persona"
    output_format: "markdown"
